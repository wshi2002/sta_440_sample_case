---
title: "MainCode"
author: "Wendy"
date: "2023-09-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(tidyverse)
library(vroom)
library(broom)
library(stats)
library("mgcv")
```


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
df <- vroom("Data/surgery_times.csv")
df

# Adding new variable depicting hour since begging of night shift
df<-df %>%
  mutate(hours_since_6pm = ifelse(hour <= 18, hour + 6, hour - 18))

# Calculating average of the variable "hours_since_6pm" in dataset
avg_obs_time <- sum(df$hours_since_6pm)/nrow(df) 
avg_obs_time


# plotting a density plot
df %>%
  ggplot(aes(x = hours_since_6pm, fill = hospital)) +
  geom_density(alpha = 0.5)
```

```{r}

# Another way to visualize data

#filtering data into hospital a and hospital b
df_a<-df%>%
  filter(hospital == "A")

df_b <- df%>%
  filter(hospital == "B")

#plotting the two data sets on a circular histogram

ggplot(data = df_a, aes(x = hour)) + geom_histogram(breaks = seq(0, 
  24), width = 2, fill = "red", color = "black", alpha = 0.5) + coord_polar(start = 0) + theme_minimal() + 
  scale_fill_brewer() + ylab("Count") + ggtitle("Events by Time of day") + 
  scale_x_continuous("", limits = c(0, 24), breaks = seq(0, 24), labels = seq(0,24))

ggplot(data = df_b, aes(x = hour)) + geom_histogram(breaks = seq(0, 
  24), width = 2, fill = "blue", color = "black", alpha = 0.5) + coord_polar(start = 0) + theme_minimal() + 
  scale_fill_brewer() + ylab("Count") + ggtitle("Events by Time of day") + 
  scale_x_continuous("", limits = c(0, 24), breaks = seq(0, 24), labels = seq(0,24))

```

```{r}
# creating two samples with just the time variable
hospital1_df <- df$hours_since_6pm[df$hospital == "A"]
hospital2_df <- df$hours_since_6pm[df$hospital == "B"]

#Because sample size is large, by central limit theorem we do not have to assume normality of population, we just need normality of sample means, a t test can be conducted.

test_result_t <- t.test(hospital1_df, hospital2_df, var.equal = TRUE)
test_result_t
```


```{r}
# fitting a simple logistic regression model on complication
df<-df%>%
  mutate(complication_coded = ifelse(complication == "Yes", 1, 0))

surgery_model <- glm(complication_coded ~ hospital + age + dow + hours_since_6pm, family = "binomial", data = df)

tidy(surgery_model)

```


```{r}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
